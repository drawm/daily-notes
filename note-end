#!/bin/bash

appRootFolder="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
source "${appRootFolder}/date-parser"

notesRootFolder="$(cat "${appRootFolder}/.noteFolderPath")"
if [ -z $notesRootFolder ]; then
  echo "Can't find root folder, did you run note-setup?"
  exit 1
fi

noteFolderLocation="${notesRootFolder}/notes"
filePath="${noteFolderLocation}/${formattedDate}.md"

cd "${notesRootFolder}"

sections=$(cat "${rootFolder}/.sections")

if [[ ! -z $sections ]]; then
  for section in $sections; do
    # Save section for next day
    . "${initialLocation}/scripts/saveSection.sh" "${filePath}" "${section}" > ".section.${section}.md"
    git add ".section.${section}.md"
  done
fi

# parseInputDate (function) and formattedDate (variable) are sourced from date-parser
parseInputDate $1
git add "${filePath}" && git commit -F "${filePath}" && git tag "${formattedDate}"


git push origin master

cd "${appRootFolder}"
